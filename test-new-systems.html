<!DOCTYPE html>
<html>
<head>
    <title>New Roguelike Systems - Test Page</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .section {
            border: 1px solid #0f0;
            margin: 20px 0;
            padding: 15px;
            background: #001100;
        }
        
        .section h2 {
            margin-top: 0;
            color: #00ff00;
            border-bottom: 1px solid #0f0;
            padding-bottom: 5px;
        }
        
        .skill-category {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #333;
            background: #000;
        }
        
        .skill-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 5px;
            margin-top: 10px;
        }
        
        .skill-item {
            padding: 2px 5px;
            font-size: 12px;
            color: #aaa;
        }
        
        .character-display {
            border: 1px solid #444;
            padding: 10px;
            margin: 10px 0;
            background: #001100;
        }
        
        .party-slot {
            display: inline-block;
            width: 150px;
            height: 100px;
            border: 1px solid #333;
            margin: 5px;
            padding: 10px;
            background: #000;
            vertical-align: top;
        }
        
        .empty-slot {
            color: #666;
            text-align: center;
            line-height: 80px;
        }
        
        .button {
            background: #002200;
            border: 1px solid #0f0;
            color: #0f0;
            padding: 5px 15px;
            margin: 5px;
            cursor: pointer;
            font-family: inherit;
        }
        
        .button:hover {
            background: #003300;
        }
        
        #log {
            height: 200px;
            overflow-y: auto;
            background: #000;
            border: 1px solid #333;
            padding: 10px;
            font-size: 12px;
        }
        
        .log-entry {
            margin: 2px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Single-Player Party-Based ASCII Roguelike</h1>
        <p>New Architecture Test - What We've Built So Far</p>

        <div class="section">
            <h2>üìä Game State System</h2>
            <div id="game-state-display">
                <div><strong>Current Location:</strong> <span id="location-type">Guild Base</span></div>
                <div><strong>Active Run:</strong> <span id="run-status">No active run</span></div>
                <div><strong>Party Members:</strong> <span id="party-count">0 / 6</span></div>
                <div><strong>Guild Gold:</strong> <span id="guild-gold">0</span></div>
            </div>
            
            <button class="button" onclick="createTestCharacter()">Create Test Character</button>
            <button class="button" onclick="startTestRun()">Start Test Run</button>
            <button class="button" onclick="showGameState()">Show Full State</button>
        </div>

        <div class="section">
            <h2>üë• Party Management (Up to 6 Characters)</h2>
            <div id="party-display">
                <div class="party-slot empty-slot">Empty Slot 1</div>
                <div class="party-slot empty-slot">Empty Slot 2</div>
                <div class="party-slot empty-slot">Empty Slot 3</div>
                <div class="party-slot empty-slot">Empty Slot 4</div>
                <div class="party-slot empty-slot">Empty Slot 5</div>
                <div class="party-slot empty-slot">Empty Slot 6</div>
            </div>
        </div>

        <div class="section">
            <h2>üéØ Skill System Overview</h2>
            <p><strong>Total Skills:</strong> <span id="total-skills">Loading...</span> across 15 categories</p>
            <p><strong>Skill Categories:</strong></p>
            <div id="skill-categories"></div>
        </div>

        <div class="section">
            <h2>‚öîÔ∏è Test Character Skills</h2>
            <div id="test-character">
                <p>Create a test character to see skill progression in action!</p>
            </div>
            <button class="button" onclick="testSkillUse()">Use Random Skill</button>
            <button class="button" onclick="showTopSkills()">Show Top Skills</button>
        </div>

        <div class="section">
            <h2>üìù Event Log</h2>
            <div id="log"></div>
            <button class="button" onclick="clearLog()">Clear Log</button>
        </div>
    </div>

    <script>
        // Import our new systems (simulate module loading)
        // In a real app, these would be proper imports
        
        // Mock the module system for browser
        const module = { exports: {} };
        const require = (path) => {
            if (path === './SkillCategories') {
                return window.SkillCategories;
            }
            return {};
        };
        
        // Load our systems
    </script>

    <!-- Load our new systems -->
    <script src="src/skills/SkillCategories.js"></script>
    <script src="src/core/EventSystem.js"></script>
    <script src="src/core/GameState.js"></script>
    <script src="src/skills/SkillSystem.js"></script>

    <script>
        // Initialize systems
        const eventSystem = new EventSystem();
        const gameState = new GameState();
        const skillSystem = new SkillSystem(eventSystem);
        let testCharacter = null;

        // Event listeners
        eventSystem.on('CHARACTER_SKILL_GAINED', (data) => {
            addLog(`${data.characterId} gained ${data.newLevel - data.oldLevel} levels in skill! (${data.oldLevel} ‚Üí ${data.newLevel})`);
            updateTestCharacterDisplay();
        });

        eventSystem.on('PARTY_MEMBER_ADDED', (data) => {
            addLog(`${data.characterId} joined the party!`);
            updatePartyDisplay();
            updateGameStateDisplay();
        });

        // Initialize display
        function initializeDisplay() {
            // Show total skill count
            const totalSkills = getTotalSkillCount();
            document.getElementById('total-skills').textContent = totalSkills;

            // Display skill categories
            const categoriesDiv = document.getElementById('skill-categories');
            Object.keys(SKILL_CATEGORIES).forEach(categoryKey => {
                const category = SKILL_CATEGORIES[categoryKey];
                const skillCount = Object.keys(category.skills).length;
                
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'skill-category';
                categoryDiv.innerHTML = `
                    <strong>${category.name}</strong> (${skillCount} skills)
                    <div class="skill-list">
                        ${Object.keys(category.skills).map(skillKey => 
                            `<div class="skill-item">${category.skills[skillKey].name}</div>`
                        ).join('')}
                    </div>
                `;
                categoriesDiv.appendChild(categoryDiv);
            });

            updateGameStateDisplay();
            addLog('Systems initialized successfully!');
            addLog(`Loaded ${totalSkills} skills across 15 categories`);
        }

        // Create a test character
        function createTestCharacter() {
            testCharacter = {
                id: 'test_char_1',
                name: 'Test Hero',
                health: 100,
                maxHealth: 100,
                level: 1,
                skills: skillSystem.initializeCharacterSkills()
            };

            // Add some random starting skills
            const randomSkills = ['one_handed', 'archery', 'healing', 'sneaking', 'climbing'];
            randomSkills.forEach(skillKey => {
                skillSystem.advanceSkill(testCharacter, skillKey, Math.floor(Math.random() * 10) + 1);
            });

            // Add to party
            const result = gameState.addPartyMember(testCharacter);
            if (result.success) {
                eventSystem.emit('PARTY_MEMBER_ADDED', { characterId: testCharacter.id });
            }

            updateTestCharacterDisplay();
            addLog(`Created test character: ${testCharacter.name}`);
        }

        // Test skill usage
        function testSkillUse() {
            if (!testCharacter) {
                addLog('Create a test character first!');
                return;
            }

            // Use a random skill
            const allSkillKeys = Object.keys(testCharacter.skills);
            const randomSkill = allSkillKeys[Math.floor(Math.random() * allSkillKeys.length)];
            const difficulties = ['trivial', 'easy', 'normal', 'hard', 'very_hard'];
            const randomDifficulty = difficulties[Math.floor(Math.random() * difficulties.length)];

            const result = skillSystem.awardSkillUse(testCharacter, randomSkill, randomDifficulty, 15);
            
            if (result.success) {
                const skillInfo = skillSystem.getSkillInfo(randomSkill);
                addLog(`Used ${skillInfo.name} (${randomDifficulty}) - Gained ${result.xpGained} XP${result.levelUp ? ' - LEVEL UP!' : ''}`);
            }
        }

        // Start a test run
        function startTestRun() {
            if (gameState.party.members.size === 0) {
                addLog('Add party members first!');
                return;
            }

            const result = gameState.startNewRun();
            if (result.success) {
                addLog(`Started new dungeon run - Floor ${result.floor}`);
                updateGameStateDisplay();
            }
        }

        // Show top skills
        function showTopSkills() {
            if (!testCharacter) {
                addLog('Create a test character first!');
                return;
            }

            const topSkills = skillSystem.getTopSkills(testCharacter, 5);
            addLog('=== TOP SKILLS ===');
            topSkills.forEach(skill => {
                addLog(`${skill.name}: Level ${skill.level} (+${skill.bonus}% bonus)`);
            });
        }

        // Update displays
        function updateGameStateDisplay() {
            document.getElementById('location-type').textContent = gameState.location.type;
            document.getElementById('run-status').textContent = gameState.currentRun.active ? 
                `Floor ${gameState.currentRun.floor}` : 'No active run';
            document.getElementById('party-count').textContent = `${gameState.party.members.size} / 6`;
            document.getElementById('guild-gold').textContent = gameState.party.gold;
        }

        function updatePartyDisplay() {
            const partySlots = document.querySelectorAll('.party-slot');
            const partyMembers = Array.from(gameState.party.members.values());
            
            partySlots.forEach((slot, index) => {
                if (partyMembers[index]) {
                    const character = partyMembers[index];
                    const topSkills = skillSystem.getTopSkills(character, 3);
                    const mastery = skillSystem.getMasteryLevel(character);
                    
                    slot.className = 'party-slot';
                    slot.innerHTML = `
                        <div><strong>${character.name}</strong></div>
                        <div>Level ${character.level}</div>
                        <div>${mastery}</div>
                        <div>HP: ${character.health}/${character.maxHealth}</div>
                        <div style="font-size: 10px; margin-top: 5px;">
                            ${topSkills.map(s => `${s.name}: ${s.level}`).join('<br>')}
                        </div>
                    `;
                } else {
                    slot.className = 'party-slot empty-slot';
                    slot.innerHTML = `Empty Slot ${index + 1}`;
                }
            });
        }

        function updateTestCharacterDisplay() {
            if (!testCharacter) return;
            
            const topSkills = skillSystem.getTopSkills(testCharacter, 10);
            const totalSkillPoints = skillSystem.getTotalSkillPoints(testCharacter);
            const mastery = skillSystem.getMasteryLevel(testCharacter);
            
            document.getElementById('test-character').innerHTML = `
                <div class="character-display">
                    <h3>${testCharacter.name} (${mastery})</h3>
                    <p><strong>Total Skill Points:</strong> ${totalSkillPoints}</p>
                    <p><strong>Top Skills:</strong></p>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        ${topSkills.map(skill => `
                            <div>${skill.name}: Level ${skill.level} (+${skill.bonus}%)</div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function showGameState() {
            const state = gameState.serialize();
            addLog('=== FULL GAME STATE ===');
            addLog(JSON.stringify(state, null, 2));
        }

        // Logging
        function addLog(message) {
            const log = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeDisplay);
    </script>
</body>
</html>